{%macro deserialize_value(target, arg)%}
{%-if arg.arg_type.name.lower() == 'primitive'%}
{{target}} = itr->value.Get{{arg.cpp_rapidjson_type}}();
{%-elif arg.arg_type.name.lower() == 'enum'%}
{{target}} = static_cast<{{arg.cpp_data_type}}>(itr->value.Get{{arg.cpp_rapidjson_type}}());
{%-elif arg.arg_type.name.lower() == 'struct'%}
{{target}} = {{arg.cpp_type}}::FromRapidJsonObject(itr->value);
{%-elif arg.arg_type.name.lower() == 'datetime'%}
auto temp{{arg.name|UpperCamelCase}}IsoString = itr->value.GetString();
{{target}} = parseIsoTimestamp(temp{{arg.name|UpperCamelCase}}IsoString);
{%-elif arg.arg_type.name.lower() == 'duration'%}
auto temp{{arg.name|UpperCamelCase}}IsoString = itr->value.GetString();
{{target}} = parseIsoDuration(temp{{arg.name|UpperCamelCase}}IsoString);
{%-elif arg.arg_type.name.lower() == 'binary'%}
auto temp{{arg.name|UpperCamelCase}}B64String = itr->value.GetString();
{{target}} = base64Decode(temp{{arg.name|UpperCamelCase}}B64String);
{%endif%}
{%endmacro%}


{%-macro deserialize(target, arglist, json_obj)%}
{%-for arg in arglist%}
{%-set arg_target %}{{target}}.{{arg.name|lowerCamelCase}}{%endset%}
{ // Scoping
    rapidjson::Value::ConstMemberIterator itr = {{json_obj}}.FindMember("{{arg.name}}");
    if (itr != {{json_obj}}.MemberEnd() && itr->value.Is{{arg.cpp_rapidjson_type}}()) {
        {{deserialize_value(arg_target, arg) | indent(8)}}
    } else {
    {%-if arg.optional%}
        {{arg_target}} = boost::none;
    {%-else%}
        throw std::runtime_error("Received payload doesn't have required value/type");
    {%endif%}
    }
}
{%-endfor%}
{%-endmacro%}